# Migration `20201003162526-init`

This migration has been generated by Taliesin at 10/3/2020, 5:25:26 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."answer" DROP CONSTRAINT "answer_poll_fkey"

CREATE TABLE "public"."Answer" (
"answer_string" text   NOT NULL ,
"id" text   NOT NULL ,
"poll" text   NOT NULL ,
"votes" integer   DEFAULT 0,
"pollId" text   ,
"voterId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PendingEmail" (
"answers" text []  ,
"email" text   NOT NULL ,
"ip" text   NOT NULL ,
"created" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("email")
)

CREATE TABLE "public"."Poll" (
"created" timestamp(3)   DEFAULT CURRENT_TIMESTAMP,
"end_date" timestamp(3)   NOT NULL ,
"id" text   NOT NULL ,
"options" text   NOT NULL ,
"question" text   NOT NULL ,
"title" text   NOT NULL ,
"voters" text []  ,
"voterId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Voter" (
"email" text   ,
"id" text   NOT NULL ,
"ip" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Voter.email_unique" ON "public"."Voter"("email")

ALTER TABLE "public"."Answer" ADD FOREIGN KEY ("pollId")REFERENCES "public"."Poll"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Answer" ADD FOREIGN KEY ("voterId")REFERENCES "public"."Voter"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Poll" ADD FOREIGN KEY ("voterId")REFERENCES "public"."Voter"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."answer"

DROP TABLE "public"."pendingemail"

DROP TABLE "public"."poll"

DROP TABLE "public"."voter"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201003162526-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,41 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Answer {
+  answer_string     String
+  id                String @default(dbgenerated()) @id
+  poll              String
+  votes             Int?   @default(0)
+}
+
+model PendingEmail {
+  answers String[]
+  email   String   @id
+  ip      String
+  created DateTime @default(now())
+}
+
+model Poll {
+  created  DateTime? @default(now())
+  end_date DateTime
+  id       String    @default(dbgenerated()) @id
+  options  String
+  question String
+  title    String
+  voters   String[]
+  answer   Answer[]
+}
+
+model Voter {
+  answers Answer[]
+  polls   Poll[]
+  email   String?  @unique
+  id      String   @default(dbgenerated()) @id
+  ip      String
+}
```


